<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Art of Calisthenics - Master TOC Editor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            line-height: 1.6;
            min-height: 100vh;
            transition: all 0.3s ease;
        }

        /* Theme Classes */
        .theme-minimal {
            background: #ffffff !important;
            color: #333333 !important;
        }

        .theme-minimal * {
            color: #333333 !important;
            border-color: rgba(0, 0, 0, 0.1) !important;
        }

        .theme-paper {
            background: #faf8f1 !important;
            color: #2c2c2c !important;
        }

        .theme-paper * {
            color: #2c2c2c !important;
            border-color: rgba(44, 44, 44, 0.1) !important;
        }

        .theme-mono {
            background: #000000 !important;
            color: #00ff00 !important;
        }

        .theme-mono * {
            color: #00ff00 !important;
            border-color: #00ff00 !important;
        }

        /* Mobile Mode */
        .mobile-mode {
            padding: 10px !important;
        }

        .mobile-mode .container {
            padding: 10px !important;
            max-width: 100% !important;
        }

        .mobile-mode .control-panel {
            font-size: 0.9rem;
        }

        .mobile-mode .control-content {
            grid-template-columns: 1fr !important;
        }

        .mobile-mode .toc-container {
            padding: 15px !important;
            border-radius: 10px !important;
        }

        .mobile-mode .part-title {
            font-size: 1.2rem !important;
        }

        .mobile-mode .chapter-title {
            font-size: 1rem !important;
        }

        .mobile-mode .subsection-title {
            font-size: 0.9rem !important;
        }

        .mobile-mode .title {
            font-size: 1.8rem !important;
        }

        /* Professional Color Editor */
        .color-editor-panel {
            padding: 20px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            margin-top: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .color-preset {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .preset-btn {
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #fff;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .preset-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }

        .preset-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0.3;
            border-radius: 6px;
        }

        .preset-btn[data-preset="ocean"]::before {
            background: linear-gradient(135deg, #0077be, #00c6ff);
        }

        .preset-btn[data-preset="sunset"]::before {
            background: linear-gradient(135deg, #ff6b6b, #feca57);
        }

        .preset-btn[data-preset="aurora"]::before {
            background: linear-gradient(135deg, #43e97b, #38f9d7);
        }

        .preset-btn[data-preset="minimal"]::before {
            background: linear-gradient(135deg, #333333, #666666);
        }

        .preset-btn[data-preset="mono"]::before {
            background: linear-gradient(135deg, #000000, #333333);
        }

        .gradient-builder {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .gradient-preview {
            height: 50px;
            border-radius: 8px;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: 2px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .gradient-preview::after {
            content: 'Live Preview';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.8rem;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .color-stop {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 6px;
        }

        .color-stop label {
            min-width: 40px;
            font-size: 0.8rem;
            color: #888;
        }

        .color-stop input[type="color"] {
            width: 40px;
            height: 30px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background: transparent;
        }

        .color-stop input[type="range"] {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }

        .color-stop input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: 2px solid #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* Voice Commands Indicator */
        .voice-indicator {
            display: none;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-top: 10px;
            animation: pulse 2s infinite;
            text-align: center;
        }

        .voice-indicator.active {
            display: block;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes slideInOut {
            0% {
                transform: translateX(100%);
                opacity: 0;
            }
            10%, 90% {
                transform: translateX(0);
                opacity: 1;
            }
            100% {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* Enhanced Professional UI Elements */
        .section-header, .part-header, .chapter-header, .major-subsection-header {
            position: relative;
            overflow: hidden;
        }

        .section-header::before, .part-header::before, .chapter-header::before, .major-subsection-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .section-header:hover::before, .part-header:hover::before, .chapter-header:hover::before, .major-subsection-header:hover::before {
            left: 100%;
        }

        /* Improved Input Styling */
        input[type="text"] {
            transition: all 0.3s ease;
            position: relative;
        }

        input[type="text"]:focus {
            background: rgba(255, 255, 255, 0.08) !important;
            outline: none;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.3);
        }

        /* Professional Loading States */
        .loading {
            position: relative;
            pointer-events: none;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Enhanced Responsive Design */
        @media (max-width: 480px) {
            .control-content {
                padding: 15px;
            }

            .theme-buttons {
                justify-content: center;
            }

            .action-buttons {
                flex-direction: column;
                gap: 8px;
            }

            .typography-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .font-size-control {
                justify-content: center;
            }
        }

        /* Professional Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #764ba2, #667eea);
        }

        /* Task Management */
        .task-list-container {
            margin-top: 30px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .task-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .task-list-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #43e97b;
        }

        .add-task-btn {
            background: #43e97b;
            border: none;
            color: #000;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .add-task-btn:hover {
            background: #38d66f;
            transform: translateY(-1px);
        }

        .task-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            margin-bottom: 8px;
            transition: all 0.2s ease;
        }

        .task-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .task-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .task-checkbox.checked {
            background: #43e97b;
            border-color: #43e97b;
        }

        .task-checkbox.checked::after {
            content: 'âœ“';
            color: #000;
            font-weight: bold;
            font-size: 0.8rem;
        }

        .task-text {
            flex: 1;
            background: transparent;
            border: none;
            color: #fff;
            padding: 5px;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .task-text.completed {
            text-decoration: line-through;
            opacity: 0.6;
        }

        .task-priority {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
        }

        .priority-high {
            background: #ff6b6b;
            color: #fff;
        }

        .priority-medium {
            background: #feca57;
            color: #000;
        }

        .priority-low {
            background: #48dbfb;
            color: #000;
        }

        .delete-task {
            width: 20px;
            height: 20px;
            background: #ff6b6b;
            color: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.2s ease;
        }

        .delete-task:hover {
            background: #ee5a24;
            transform: scale(1.1);
        }

        /* Typography Controls */
        .typography-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 5px;
            margin-top: 10px;
        }

        .font-size-control {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .font-btn {
            width: 30px;
            height: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: inherit;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .font-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .font-display {
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            min-width: 50px;
            text-align: center;
        }

        /* Control Panel at Top */
        .control-panel {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            max-height: 300px;
            overflow-y: auto;
        }

        .control-panel.minimized {
            transform: translateY(-90%);
        }

        .control-header {
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.02);
        }

        .control-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #667eea;
        }

        .minimize-btn {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #888;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .minimize-btn:hover {
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
        }

        .control-content {
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            background: rgba(255, 255, 255, 0.01);
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .control-group label {
            font-size: 0.85rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .theme-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .theme-btn {
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #fff;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
        }

        .theme-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }

        .theme-btn.active {
            background: #667eea;
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            flex: 1;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #fff;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }

        .action-btn.primary {
            background: #667eea;
            border-color: #667eea;
        }

        .action-btn.primary:hover {
            background: #7a8ff0;
        }

        /* Toggle Button when minimized */
        .control-toggle {
            position: fixed;
            top: 10px;
            right: 20px;
            z-index: 1001;
            background: #667eea;
            border: none;
            color: #fff;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
        }

        .control-toggle.visible {
            opacity: 1;
            pointer-events: all;
        }

        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 0;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .title {
            font-size: 3rem;
            font-weight: 900;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #888;
            margin-bottom: 15px;
        }

        .status-badge {
            display: inline-block;
            padding: 8px 16px;
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: #000;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* TOC Container */
        .toc-container {
            background: rgba(15, 15, 15, 0.8);
            border-radius: 20px;
            padding: 40px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        /* Section Styles */
        .section {
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.02);
        }

        .section-header {
            padding: 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .section-header:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .section-title {
            font-size: 1.4rem;
            font-weight: 700;
            background: linear-gradient(135deg, #ffffff 0%, #cccccc 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .collapse-icon {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
            color: #888;
        }

        .section.collapsed .collapse-icon {
            transform: rotate(-90deg);
        }

        .section-content {
            padding: 0 20px 20px 20px;
            display: block;
        }

        .section.collapsed .section-content {
            display: none;
        }

        /* Matter Items */
        .matter-item, .intro-item {
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .matter-item:last-child, .intro-item:last-child {
            border-bottom: none;
        }

        .matter-title, .intro-title {
            flex: 1;
            background: transparent;
            border: none;
            color: #ffffff;
            font-size: 1rem;
            padding: 8px 12px;
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: text;
        }

        .matter-title:hover, .matter-title:focus,
        .intro-title:hover, .intro-title:focus {
            background: rgba(255, 255, 255, 0.05);
            outline: none;
        }

        .intro-bullet {
            color: #667eea;
            font-weight: bold;
            min-width: 20px;
        }

        /* Parts */
        .part {
            margin-bottom: 35px;
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.03);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .part-header {
            padding: 30px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        }

        .part-header:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.15) 100%);
        }

        .part-title {
            font-size: 1.6rem;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .part.collapsed .collapse-icon {
            transform: rotate(-90deg);
        }

        .chapters {
            padding: 25px;
            display: block;
        }

        .part.collapsed .chapters {
            display: none;
        }

        /* Chapters */
        .chapter {
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.02);
        }

        .chapter-header {
            padding: 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            background: rgba(255, 255, 255, 0.01);
        }

        .chapter-header:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .chapter-main {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }

        .chapter-number {
            font-weight: 700;
            color: #667eea;
            min-width: 120px;
            font-size: 1.1rem;
        }

        .chapter-title {
            flex: 1;
            background: transparent;
            border: none;
            color: #ffffff;
            font-size: 1.2rem;
            font-weight: 600;
            padding: 10px 15px;
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: text;
        }

        .chapter-title:hover, .chapter-title:focus {
            background: rgba(255, 255, 255, 0.05);
            outline: none;
        }

        .chapter.collapsed .collapse-icon {
            transform: rotate(-90deg);
        }

        .chapter-content {
            padding: 20px;
            display: block;
        }

        .chapter.collapsed .chapter-content {
            display: none;
        }

        /* Subsections */
        .subsection {
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .subsection:last-child {
            border-bottom: none;
        }

        .subsection-number {
            color: #888;
            font-weight: 600;
            min-width: 50px;
            font-size: 0.95rem;
        }

        .subsection-title {
            flex: 1;
            background: transparent;
            border: none;
            color: #ffffff;
            font-size: 1rem;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.3s ease;
            cursor: text;
        }

        .subsection-title:hover, .subsection-title:focus {
            background: rgba(255, 255, 255, 0.05);
            outline: none;
        }

        /* Major Subsections */
        .major-subsection {
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.01);
        }

        .major-subsection-header {
            padding: 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
        }

        .major-subsection-header:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        .major-subsection-main {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }

        .major-subsection-number {
            color: #43e97b;
            font-weight: 600;
            min-width: 50px;
            font-size: 0.95rem;
        }

        .major-subsection-title {
            flex: 1;
            background: transparent;
            border: none;
            color: #ffffff;
            font-size: 1rem;
            font-weight: 500;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.3s ease;
            cursor: text;
        }

        .major-subsection-title:hover, .major-subsection-title:focus {
            background: rgba(255, 255, 255, 0.05);
            outline: none;
        }

        .major-subsection.collapsed .collapse-icon {
            transform: rotate(-90deg);
        }

        .minor-subsections {
            padding: 15px;
            display: block;
        }

        .major-subsection.collapsed .minor-subsections {
            display: none;
        }

        /* Minor Subsections */
        .minor-subsection {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
            display: flex;
            align-items: center;
            gap: 15px;
            margin-left: 20px;
        }

        .minor-subsection:last-child {
            border-bottom: none;
        }

        .minor-subsection-number {
            color: #ff6b9d;
            font-weight: 600;
            min-width: 60px;
            font-size: 0.9rem;
        }

        .minor-subsection-title {
            flex: 1;
            background: transparent;
            border: none;
            color: #ffffff;
            font-size: 0.95rem;
            padding: 6px 10px;
            border-radius: 6px;
            transition: all 0.3s ease;
            cursor: text;
        }

        .minor-subsection-title:hover, .minor-subsection-title:focus {
            background: rgba(255, 255, 255, 0.05);
            outline: none;
        }

        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: #667eea;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            color: #fff;
            font-size: 1.5rem;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        /* Corrections Box */
        .corrections-box {
            background: linear-gradient(135deg, rgba(67, 233, 123, 0.1) 0%, rgba(56, 249, 215, 0.1) 100%);
            border: 2px solid rgba(67, 233, 123, 0.3);
            margin: 30px 0;
            padding: 25px;
            border-radius: 15px;
        }

        .corrections-title {
            font-weight: 700;
            color: #43e97b;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .corrections-list {
            list-style: none;
            padding: 0;
        }

        .corrections-list li {
            padding: 5px 0;
            color: #ffffff;
            font-size: 0.95rem;
        }

        .corrections-list li::before {
            content: "âœ… ";
            color: #43e97b;
            font-weight: bold;
            margin-right: 8px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .control-content {
                grid-template-columns: 1fr;
            }

            .container {
                padding: 15px;
            }

            .title {
                font-size: 2rem;
            }

            .toc-container {
                padding: 20px;
            }

            .chapter-number {
                min-width: 100px;
                font-size: 1rem;
            }

            .part-header {
                padding: 20px;
            }

            .part-title {
                font-size: 1.3rem;
            }

            .fab {
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }
        }

        /* Auto-save indicator */
        .auto-save-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(67, 233, 123, 0.9);
            color: #000;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 10000;
        }

        .auto-save-indicator.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- Control Panel -->
    <div class="control-panel minimized" id="controlPanel">
        <div class="control-header">
            <div class="control-title">ðŸŽ¨ TOC EDITOR CONTROLS</div>
            <button class="minimize-btn" onclick="toggleControlPanel()">Hide Controls â†‘</button>
        </div>
        <div class="control-content">
            <div class="control-group">
                <label>Themes</label>
                <div class="theme-buttons">
                    <button class="theme-btn active" onclick="setTheme('dark', this)">ðŸŒ™ Dark</button>
                    <button class="theme-btn" onclick="setTheme('minimal', this)">âšª Minimal</button>
                    <button class="theme-btn" onclick="setTheme('paper', this)">ðŸ“„ Paper</button>
                    <button class="theme-btn" onclick="setTheme('mono', this)">ðŸ’š Mono</button>
                    <button class="theme-btn" onclick="setTheme('ocean', this)">ðŸŒŠ Ocean</button>
                </div>
            </div>

            <div class="control-group">
                <label>Display Options</label>
                <div class="action-buttons">
                    <button class="action-btn" id="mobileBtn" onclick="toggleMobileMode()">ðŸ“± Mobile View</button>
                    <button class="action-btn" onclick="toggleAllSections()">ðŸ“‚ Toggle All</button>
                    <button class="action-btn" onclick="toggleSubsections()">ðŸ“„ Toggle Subsections</button>
                </div>
            </div>

            <div class="control-group">
                <label>Export Options</label>
                <div class="action-buttons">
                    <button class="action-btn primary" onclick="exportTOC()">ðŸ’¾ HTML</button>
                    <button class="action-btn" onclick="exportAsText()">ðŸ“„ Text</button>
                    <button class="action-btn" onclick="exportAsJSON()">ðŸ“Š JSON</button>
                </div>
            </div>

            <div class="control-group">
                <label>Voice Commands</label>
                <div class="action-buttons">
                    <button class="action-btn" id="voiceBtn" onclick="toggleVoiceCommands()">ðŸŽ¤ Start Voice</button>
                </div>
                <div class="voice-indicator" id="voiceIndicator">
                    ðŸ”´ Listening... (say "help" for commands)
                </div>
            </div>

            <!-- Typography Controls -->
            <div class="control-group">
                <label>Typography</label>
                <div class="typography-controls">
                    <div class="font-size-control">
                        <button class="font-btn" onclick="adjustFontSize(-1)">A-</button>
                        <div class="font-display" id="fontSizeDisplay">100%</div>
                        <button class="font-btn" onclick="adjustFontSize(1)">A+</button>
                    </div>
                    <select id="fontFamily" onchange="changeFontFamily()" style="background: rgba(255, 255, 255, 0.05); color: inherit; border: 1px solid rgba(255, 255, 255, 0.2); padding: 5px; border-radius: 5px;">
                        <option value="'Inter', -apple-system, sans-serif">Inter</option>
                        <option value="'Georgia', serif">Georgia</option>
                        <option value="'Courier New', monospace">Mono</option>
                        <option value="'Helvetica Neue', sans-serif">Helvetica</option>
                        <option value="'Times New Roman', serif">Times</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Professional Color Editor -->
        <div class="color-editor-panel">
            <label style="color: #43e97b; font-weight: 600; margin-bottom: 10px; display: block;">ðŸŽ¨ PROFESSIONAL GRADIENT EDITOR</label>
            <div class="color-preset">
                <button class="preset-btn" data-preset="ocean" onclick="applyPreset('ocean')">ðŸŒŠ Ocean</button>
                <button class="preset-btn" data-preset="sunset" onclick="applyPreset('sunset')">ðŸŒ… Sunset</button>
                <button class="preset-btn" data-preset="aurora" onclick="applyPreset('aurora')">ðŸŒŒ Aurora</button>
                <button class="preset-btn" data-preset="minimal" onclick="applyPreset('minimal')">âšª Minimal</button>
                <button class="preset-btn" data-preset="mono" onclick="applyPreset('mono')">ðŸ’š Mono</button>
            </div>
            <div class="gradient-builder">
                <div class="gradient-preview" id="gradientPreview"></div>
                <div class="color-stop">
                    <label style="color: #888; font-size: 0.8rem;">Start</label>
                    <input type="color" id="gradientStart" value="#667eea" onchange="updateGradient()">
                    <input type="range" id="startPosition" min="0" max="100" value="0" onchange="updateGradient()">
                </div>
                <div class="color-stop">
                    <label style="color: #888; font-size: 0.8rem;">End</label>
                    <input type="color" id="gradientEnd" value="#764ba2" onchange="updateGradient()">
                    <input type="range" id="endPosition" min="0" max="100" value="100" onchange="updateGradient()">
                </div>
                <div class="action-buttons" style="margin-top: 10px;">
                    <button class="action-btn" onclick="applyGradientToSelection()">Apply Selection</button>
                    <button class="action-btn" onclick="applyGradientToAll()">Apply All</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toggle Button (visible when panel is hidden) -->
    <button class="control-toggle visible" id="controlToggle" onclick="toggleControlPanel()">
        ðŸŽ¨ Show Controls
    </button>

    <!-- Auto-save indicator -->
    <div class="auto-save-indicator" id="autoSaveIndicator">
        âœ“ Auto-saved
    </div>

    <div class="container">
        <div class="header">
            <h1 class="title">ðŸ“š THE ART OF CALISTHENICS</h1>
            <p class="subtitle">Master TOC Editor - Full 27 Chapters</p>
            <div class="status-badge">âœ… FULLY STABILIZED VERSION</div>
        </div>

        <div class="toc-container">
            <!-- Front Matter -->
            <div class="section">
                <div class="section-header" onclick="toggleSection(this)">
                    <div class="section-title">FRONT MATTER</div>
                    <div class="collapse-icon">â–¼</div>
                </div>
                <div class="section-content">
                    <div class="matter-item">
                        <input type="text" class="matter-title" value="Dedication">
                    </div>
                    <div class="matter-item">
                        <input type="text" class="matter-title" value="Foreword (by Victory Belt)">
                    </div>
                    <div class="matter-item">
                        <input type="text" class="matter-title" value="Preface (Your Journey to This Book)">
                    </div>
                    <div class="matter-item">
                        <input type="text" class="matter-title" value="Disclaimer (Medical/Legal)">
                    </div>
                    <div class="matter-item">
                        <input type="text" class="matter-title" value="How to Use This Book (Navigation Guide + System Thinking)">
                    </div>
                    <div class="matter-item">
                        <input type="text" class="matter-title" value="Movement DNA Index (Cross-Reference System)">
                    </div>
                </div>
            </div>

            <!-- THE SPARK: Introduction -->
            <div class="section">
                <div class="section-header" onclick="toggleSection(this)">
                    <div class="section-title">THE SPARK: Introduction</div>
                    <div class="collapse-icon">â–¼</div>
                </div>
                <div class="section-content">
                    <div class="intro-item">
                        <span class="intro-bullet">â€¢</span>
                        <input type="text" class="intro-title" value="The Movement Paradox">
                    </div>
                    <div class="intro-item">
                        <span class="intro-bullet">â€¢</span>
                        <input type="text" class="intro-title" value="Why Calisthenics?">
                    </div>
                    <div class="intro-item">
                        <span class="intro-bullet">â€¢</span>
                        <input type="text" class="intro-title" value="Movement as Humanity's First Language">
                    </div>
                    <div class="intro-item">
                        <span class="intro-bullet">â€¢</span>
                        <input type="text" class="intro-title" value="The four lenses of progress">
                    </div>
                    <div class="intro-item">
                        <span class="intro-bullet">â€¢</span>
                        <input type="text" class="intro-title" value="Your Journey Begins Here">
                    </div>
                    <div class="intro-item">
                        <span class="intro-bullet">â€¢</span>
                        <input type="text" class="intro-title" value="The Author's Story (2019â€“2025 Evolution)">
                    </div>
                    <div class="intro-item">
                        <span class="intro-bullet">â€¢</span>
                        <input type="text" class="intro-title" value="The Movement Ecosystem Universe Explained">
                    </div>
                </div>
            </div>

            <!-- Part I: BEGIN -->
            <div class="part">
                <div class="part-header" onclick="toggleSection(this)">
                    <div class="part-title">I: BEGIN â€” Start Here</div>
                    <div class="collapse-icon">â–¼</div>
                </div>
                <div class="chapters">
                    <div class="chapter collapsed">
                        <div class="chapter-header" onclick="toggleSection(this)">
                            <div class="chapter-main">
                                <span class="chapter-number">Chapter 1:</span>
                                <input type="text" class="chapter-title" value="What, How, Why & Who">
                            </div>
                            <div class="collapse-icon">â–¼</div>
                        </div>
                        <div class="chapter-content">
                            <div class="subsection">
                                <span class="subsection-number">1.1</span>
                                <input type="text" class="subsection-title" value="Why Do You Move? (The Fundamental Question)">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">1.2</span>
                                <input type="text" class="subsection-title" value="The Purpose Formula: Survivalâ†’Statusâ†’Successâ†’Meaning">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">1.3</span>
                                <input type="text" class="subsection-title" value="What This Book Will Teach You (The Complete Scope)">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">1.4</span>
                                <input type="text" class="subsection-title" value="How to Best Approach This Book (System Thinking Research)">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">1.5</span>
                                <input type="text" class="subsection-title" value="Who Is This Book For? (The Three Archetypes)">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">1.6</span>
                                <input type="text" class="subsection-title" value="Your Starting Point Assessment">
                            </div>
                        </div>
                    </div>

                    <div class="chapter collapsed">
                        <div class="chapter-header" onclick="toggleSection(this)">
                            <div class="chapter-main">
                                <span class="chapter-number">Chapter 2:</span>
                                <input type="text" class="chapter-title" value="Getting Started">
                            </div>
                            <div class="collapse-icon">â–¼</div>
                        </div>
                        <div class="chapter-content">
                            <div class="subsection">
                                <span class="subsection-number">2.1</span>
                                <input type="text" class="subsection-title" value="More Action, Less Knowledge (The 80/20 Principle)">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">2.2</span>
                                <input type="text" class="subsection-title" value="Practice, Practice, Practice (Consistency Framework)">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">2.3</span>
                                <input type="text" class="subsection-title" value="Direction Over Speed (Patience Philosophy)">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">2.4</span>
                                <input type="text" class="subsection-title" value="Your First Week Protocol">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">2.5</span>
                                <input type="text" class="subsection-title" value="Common Beginner Mistakes">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">2.6</span>
                                <input type="text" class="subsection-title" value="Building Momentum">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Part II: CRAFT -->
            <div class="part">
                <div class="part-header" onclick="toggleSection(this)">
                    <div class="part-title">II: CRAFT â€” The Art of Calisthenics</div>
                    <div class="collapse-icon">â–¼</div>
                </div>
                <div class="chapters">
                    <div class="chapter collapsed">
                        <div class="chapter-header" onclick="toggleSection(this)">
                            <div class="chapter-main">
                                <span class="chapter-number">Chapter 3:</span>
                                <input type="text" class="chapter-title" value="What is Calisthenics?">
                            </div>
                            <div class="collapse-icon">â–¼</div>
                        </div>
                        <div class="chapter-content">
                            <div class="subsection">
                                <span class="subsection-number">3.1</span>
                                <input type="text" class="subsection-title" value="Definition & History">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">3.2</span>
                                <input type="text" class="subsection-title" value="Advantages Over Traditional Training">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">3.3</span>
                                <input type="text" class="subsection-title" value="Disadvantages & Limitations">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">3.4</span>
                                <input type="text" class="subsection-title" value="Foundation For Future Training">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">3.5</span>
                                <input type="text" class="subsection-title" value="The Movement Ecosystem Concept">
                            </div>
                        </div>
                    </div>

                    <div class="chapter collapsed">
                        <div class="chapter-header" onclick="toggleSection(this)">
                            <div class="chapter-main">
                                <span class="chapter-number">Chapter 4:</span>
                                <input type="text" class="chapter-title" value="Calisthenics vs Gymnastics">
                            </div>
                            <div class="collapse-icon">â–¼</div>
                        </div>
                        <div class="chapter-content">
                            <div class="subsection">
                                <span class="subsection-number">4.1</span>
                                <input type="text" class="subsection-title" value="Historical Divergence">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">4.2</span>
                                <input type="text" class="subsection-title" value="Training Methodology Differences">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">4.3</span>
                                <input type="text" class="subsection-title" value="Accessibility Factors">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">4.4</span>
                                <input type="text" class="subsection-title" value="Skill Transfer Between Disciplines">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">4.5</span>
                                <input type="text" class="subsection-title" value="Choosing Your Path">
                            </div>
                        </div>
                    </div>

                    <div class="chapter collapsed">
                        <div class="chapter-header" onclick="toggleSection(this)">
                            <div class="chapter-main">
                                <span class="chapter-number">Chapter 5:</span>
                                <input type="text" class="chapter-title" value="Calisthenics Training for the Lower Body">
                            </div>
                            <div class="collapse-icon">â–¼</div>
                        </div>
                        <div class="chapter-content">
                            <div class="subsection">
                                <span class="subsection-number">5.1</span>
                                <input type="text" class="subsection-title" value="The Lower Body Myth">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">5.2</span>
                                <input type="text" class="subsection-title" value="Unilateral Training Superiority">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">5.3</span>
                                <input type="text" class="subsection-title" value="Jump Training & Plyometrics">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">5.4</span>
                                <input type="text" class="subsection-title" value="Weighted Variations">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">5.5</span>
                                <input type="text" class="subsection-title" value="Integration with Upper Body">
                            </div>
                        </div>
                    </div>

                    <div class="chapter collapsed">
                        <div class="chapter-header" onclick="toggleSection(this)">
                            <div class="chapter-main">
                                <span class="chapter-number">Chapter 6:</span>
                                <input type="text" class="chapter-title" value="Calisthenics is for Everyone">
                            </div>
                            <div class="collapse-icon">â–¼</div>
                        </div>
                        <div class="chapter-content">
                            <div class="subsection">
                                <span class="subsection-number">6.1</span>
                                <input type="text" class="subsection-title" value="Then & Now: Evolution of the Discipline">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">6.2</span>
                                <input type="text" class="subsection-title" value="My Training Philosophy">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">6.3</span>
                                <input type="text" class="subsection-title" value="The 3 Archetypes (Seeker, Builder, Practitioner)">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">6.4</span>
                                <input type="text" class="subsection-title" value="Age, Gender, and Background Considerations">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">6.5</span>
                                <input type="text" class="subsection-title" value="Calisthenics in Sports Performance">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">6.6</span>
                                <input type="text" class="subsection-title" value="Adaptive Calisthenics">
                            </div>
                        </div>
                    </div>

                    <div class="chapter collapsed">
                        <div class="chapter-header" onclick="toggleSection(this)">
                            <div class="chapter-main">
                                <span class="chapter-number">Chapter 7:</span>
                                <input type="text" class="chapter-title" value="Is Calisthenics Safe?">
                            </div>
                            <div class="collapse-icon">â–¼</div>
                        </div>
                        <div class="chapter-content">
                            <div class="subsection">
                                <span class="subsection-number">7.1</span>
                                <input type="text" class="subsection-title" value="Injury Statistics vs Traditional Training">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">7.2</span>
                                <input type="text" class="subsection-title" value="Joint Health Benefits">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">7.3</span>
                                <input type="text" class="subsection-title" value="Progressive Overload Principles">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">7.4</span>
                                <input type="text" class="subsection-title" value="Risk Management Strategies">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">7.5</span>
                                <input type="text" class="subsection-title" value="Long-term Sustainability">
                            </div>
                        </div>
                    </div>

                    <div class="chapter collapsed">
                        <div class="chapter-header" onclick="toggleSection(this)">
                            <div class="chapter-main">
                                <span class="chapter-number">Chapter 8:</span>
                                <input type="text" class="chapter-title" value="What to Expect from Calisthenics?">
                            </div>
                            <div class="collapse-icon">â–¼</div>
                        </div>
                        <div class="chapter-content">
                            <div class="subsection">
                                <span class="subsection-number">8.1</span>
                                <input type="text" class="subsection-title" value="Realistic Timeline Expectations">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">8.2</span>
                                <input type="text" class="subsection-title" value="Physical Transformations">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">8.3</span>
                                <input type="text" class="subsection-title" value="Mental & Emotional Changes">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">8.4</span>
                                <input type="text" class="subsection-title" value="Life Demands and Sacrifices">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">8.5</span>
                                <input type="text" class="subsection-title" value="The Compound Effect">
                            </div>
                        </div>
                    </div>

                    <div class="chapter collapsed">
                        <div class="chapter-header" onclick="toggleSection(this)">
                            <div class="chapter-main">
                                <span class="chapter-number">Chapter 9:</span>
                                <input type="text" class="chapter-title" value="Goal Setting">
                            </div>
                            <div class="collapse-icon">â–¼</div>
                        </div>
                        <div class="chapter-content">
                            <div class="subsection">
                                <span class="subsection-number">9.1</span>
                                <input type="text" class="subsection-title" value="SMART Goals Adapted for Calisthenics">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">9.2</span>
                                <input type="text" class="subsection-title" value="Process vs Outcome Goals">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">9.3</span>
                                <input type="text" class="subsection-title" value="Milestone Mapping">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">9.4</span>
                                <input type="text" class="subsection-title" value="Tracking Progress">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">9.5</span>
                                <input type="text" class="subsection-title" value="Adjusting Expectations">
                            </div>
                        </div>
                    </div>

                    <div class="chapter collapsed">
                        <div class="chapter-header" onclick="toggleSection(this)">
                            <div class="chapter-main">
                                <span class="chapter-number">Chapter 10:</span>
                                <input type="text" class="chapter-title" value="Equipment Guide">
                            </div>
                            <div class="collapse-icon">â–¼</div>
                        </div>
                        <div class="chapter-content">
                            <div class="subsection">
                                <span class="subsection-number">10.1</span>
                                <input type="text" class="subsection-title" value="Minimal vs Optimal Equipment Philosophy">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">10.2</span>
                                <input type="text" class="subsection-title" value="Essential Equipment (Pull-up Bar, Parallettes)">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">10.3</span>
                                <input type="text" class="subsection-title" value="Optional Equipment (Rings, Resistance Bands)">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">10.4</span>
                                <input type="text" class="subsection-title" value="Home Gym Setup Guide">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">10.5</span>
                                <input type="text" class="subsection-title" value="Weighted Calisthenics Tools">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">10.6</span>
                                <input type="text" class="subsection-title" value="Integration with Free Weights">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Part III: DEEPEN -->
            <div class="part">
                <div class="part-header" onclick="toggleSection(this)">
                    <div class="part-title">III: DEEPEN â€” The Mastering Process</div>
                    <div class="collapse-icon">â–¼</div>
                </div>
                <div class="chapters">
                    <div class="chapter collapsed">
                        <div class="chapter-header" onclick="toggleSection(this)">
                            <div class="chapter-main">
                                <span class="chapter-number">Chapter 11:</span>
                                <input type="text" class="chapter-title" value="The Perfect Form Paradox">
                            </div>
                            <div class="collapse-icon">â–¼</div>
                        </div>
                        <div class="chapter-content">
                            <div class="subsection">
                                <span class="subsection-number">11.1</span>
                                <input type="text" class="subsection-title" value="Injuries (Learning from Pain)">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">11.2</span>
                                <input type="text" class="subsection-title" value="Effectiveness (Results Measurement)">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">11.3</span>
                                <input type="text" class="subsection-title" value="Efficiency (Energy Economy)">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">11.4</span>
                                <input type="text" class="subsection-title" value="Replicability (Consistency Standards)">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">11.5</span>
                                <input type="text" class="subsection-title" value="Transferability (Skill Connections)">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">11.6</span>
                                <input type="text" class="subsection-title" value="Aesthetics (Form & Function)">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">11.7</span>
                                <input type="text" class="subsection-title" value="Excellence vs. Perfection">
                            </div>
                        </div>
                    </div>

                    <div class="chapter collapsed">
                        <div class="chapter-header" onclick="toggleSection(this)">
                            <div class="chapter-main">
                                <span class="chapter-number">Chapter 12:</span>
                                <input type="text" class="chapter-title" value="The Calisthenics Journey">
                            </div>
                            <div class="collapse-icon">â–¼</div>
                        </div>
                        <div class="chapter-content">
                            <div class="subsection">
                                <span class="subsection-number">12.1</span>
                                <input type="text" class="subsection-title" value="The Growth Mindset">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">12.2</span>
                                <input type="text" class="subsection-title" value="The Beginner's Mind">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">12.3</span>
                                <input type="text" class="subsection-title" value="The Approach Philosophy">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">12.4</span>
                                <input type="text" class="subsection-title" value="The Warm-Up Ritual">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">12.5</span>
                                <input type="text" class="subsection-title" value="Mental Models for Progress">
                            </div>
                        </div>
                    </div>

                    <div class="chapter collapsed">
                        <div class="chapter-header" onclick="toggleSection(this)">
                            <div class="chapter-main">
                                <span class="chapter-number">Chapter 13:</span>
                                <input type="text" class="chapter-title" value="The Three Stages">
                            </div>
                            <div class="collapse-icon">â–¼</div>
                        </div>
                        <div class="chapter-content">
                            <div class="major-subsection collapsed">
                                <div class="major-subsection-header" onclick="toggleSection(this)">
                                    <div class="major-subsection-main">
                                        <span class="major-subsection-number">13.1</span>
                                        <input type="text" class="major-subsection-title" value="Stage 1: Creating the Base (Foundation)">
                                    </div>
                                    <div class="collapse-icon">â–¼</div>
                                </div>
                                <div class="minor-subsections">
                                    <div class="minor-subsection">
                                        <span class="minor-subsection-number">13.1.1</span>
                                        <input type="text" class="minor-subsection-title" value="Movement Literacy Development">
                                    </div>
                                    <div class="minor-subsection">
                                        <span class="minor-subsection-number">13.1.2</span>
                                        <input type="text" class="minor-subsection-title" value="Scapular Control Mastering">
                                    </div>
                                    <div class="minor-subsection">
                                        <span class="minor-subsection-number">13.1.3</span>
                                        <input type="text" class="minor-subsection-title" value="Fundamental Static Positions">
                                    </div>
                                    <div class="minor-subsection">
                                        <span class="minor-subsection-number">13.1.4</span>
                                        <input type="text" class="minor-subsection-title" value="Core Movement Patterns">
                                    </div>
                                </div>
                            </div>
                            <div class="major-subsection collapsed">
                                <div class="major-subsection-header" onclick="toggleSection(this)">
                                    <div class="major-subsection-main">
                                        <span class="major-subsection-number">13.2</span>
                                        <input type="text" class="major-subsection-title" value="Stage 2: Building the Structure (Development)">
                                    </div>
                                    <div class="collapse-icon">â–¼</div>
                                </div>
                                <div class="minor-subsections">
                                    <div class="minor-subsection">
                                        <span class="minor-subsection-number">13.2.1</span>
                                        <input type="text" class="minor-subsection-title" value="Strength Integration Phase">
                                    </div>
                                    <div class="minor-subsection">
                                        <span class="minor-subsection-number">13.2.2</span>
                                        <input type="text" class="minor-subsection-title" value="The Big Seven Skills Introduction">
                                    </div>
                                    <div class="minor-subsection">
                                        <span class="minor-subsection-number">13.2.3</span>
                                        <input type="text" class="minor-subsection-title" value="Power Development">
                                    </div>
                                </div>
                            </div>
                            <div class="major-subsection collapsed">
                                <div class="major-subsection-header" onclick="toggleSection(this)">
                                    <div class="major-subsection-main">
                                        <span class="major-subsection-number">13.3</span>
                                        <input type="text" class="major-subsection-title" value="Stage 3: Continuous Mastering (Specialization)">
                                    </div>
                                    <div class="collapse-icon">â–¼</div>
                                </div>
                                <div class="minor-subsections">
                                    <div class="minor-subsection">
                                        <span class="minor-subsection-number">13.3.1</span>
                                        <input type="text" class="minor-subsection-title" value="Advanced Skill Development">
                                    </div>
                                    <div class="minor-subsection">
                                        <span class="minor-subsection-number">13.3.2</span>
                                        <input type="text" class="minor-subsection-title" value="Power-Free Movements">
                                    </div>
                                    <div class="minor-subsection">
                                        <span class="minor-subsection-number">13.3.3</span>
                                        <input type="text" class="minor-subsection-title" value="Dynamic Skill Integration">
                                    </div>
                                    <div class="minor-subsection">
                                        <span class="minor-subsection-number">13.3.4</span>
                                        <input type="text" class="minor-subsection-title" value="Personal Style Development">
                                    </div>
                                </div>
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">13.4</span>
                                <input type="text" class="subsection-title" value="Transition Protocols">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">13.5</span>
                                <input type="text" class="subsection-title" value="Stage Assessment Criteria">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Part IV: CHOOSE -->
            <div class="part">
                <div class="part-header" onclick="toggleSection(this)">
                    <div class="part-title">IV: CHOOSE â€” Your Unique Odyssey</div>
                    <div class="collapse-icon">â–¼</div>
                </div>
                <div class="chapters">
                    <div class="chapter collapsed">
                        <div class="chapter-header" onclick="toggleSection(this)">
                            <div class="chapter-main">
                                <span class="chapter-number">Chapter 14:</span>
                                <input type="text" class="chapter-title" value="Bodybuilding">
                            </div>
                            <div class="collapse-icon">â–¼</div>
                        </div>
                        <div class="chapter-content">
                            <div class="subsection">
                                <span class="subsection-number">14.1</span>
                                <input type="text" class="subsection-title" value="Aesthetics Philosophy">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">14.2</span>
                                <input type="text" class="subsection-title" value="Hypertrophy Fundamentals">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">14.3</span>
                                <input type="text" class="subsection-title" value="Volume Prescription">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">14.4</span>
                                <input type="text" class="subsection-title" value="Effort & Intensity Management">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">14.5</span>
                                <input type="text" class="subsection-title" value="Nutrition for Muscle Building">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">14.6</span>
                                <input type="text" class="subsection-title" value="Sample Programs">
                            </div>
                        </div>
                    </div>

                    <div class="chapter collapsed">
                        <div class="chapter-header" onclick="toggleSection(this)">
                            <div class="chapter-main">
                                <span class="chapter-number">Chapter 15:</span>
                                <input type="text" class="chapter-title" value="Power Free">
                            </div>
                            <div class="collapse-icon">â–¼</div>
                        </div>
                        <div class="chapter-content">
                            <div class="subsection">
                                <span class="subsection-number">15.1</span>
                                <input type="text" class="subsection-title" value="Static Strength Science">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">15.2</span>
                                <input type="text" class="subsection-title" value="Handstand Push-Up Progression">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">15.3</span>
                                <input type="text" class="subsection-title" value="90-Degree Handstand Push-Up">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">15.4</span>
                                <input type="text" class="subsection-title" value="Planche Development">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">15.5</span>
                                <input type="text" class="subsection-title" value="Front Lever Mastering">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">15.6</span>
                                <input type="text" class="subsection-title" value="One-Arm Pull-Up Journey">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">15.7</span>
                                <input type="text" class="subsection-title" value="Combining Static Skills">
                            </div>
                        </div>
                    </div>

                    <div class="chapter collapsed">
                        <div class="chapter-header" onclick="toggleSection(this)">
                            <div class="chapter-main">
                                <span class="chapter-number">Chapter 16:</span>
                                <input type="text" class="chapter-title" value="Freestyle Calisthenics">
                            </div>
                            <div class="collapse-icon">â–¼</div>
                        </div>
                        <div class="chapter-content">
                            <div class="subsection">
                                <span class="subsection-number">16.1</span>
                                <input type="text" class="subsection-title" value="Competition Standards">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">16.2</span>
                                <input type="text" class="subsection-title" value="Risk vs. Reward Analysis">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">16.3</span>
                                <input type="text" class="subsection-title" value="Flow State Development">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">16.4</span>
                                <input type="text" class="subsection-title" value="Fear Management">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">16.5</span>
                                <input type="text" class="subsection-title" value="Creative Expression">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">16.6</span>
                                <input type="text" class="subsection-title" value="Building Combinations">
                            </div>
                        </div>
                    </div>

                    <div class="chapter collapsed">
                        <div class="chapter-header" onclick="toggleSection(this)">
                            <div class="chapter-main">
                                <span class="chapter-number">Chapter 17:</span>
                                <input type="text" class="chapter-title" value="Street Lifting">
                            </div>
                            <div class="collapse-icon">â–¼</div>
                        </div>
                        <div class="chapter-content">
                            <div class="subsection">
                                <span class="subsection-number">17.1</span>
                                <input type="text" class="subsection-title" value="Understanding Maximal Strength">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">17.2</span>
                                <input type="text" class="subsection-title" value="Competition Rules & Standards">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">17.3</span>
                                <input type="text" class="subsection-title" value="The Weighted Dip">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">17.4</span>
                                <input type="text" class="subsection-title" value="The Weighted Pull-Up">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">17.5</span>
                                <input type="text" class="subsection-title" value="The Weighted Muscle-Up">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">17.6</span>
                                <input type="text" class="subsection-title" value="The Squat">
                            </div>
                        </div>
                    </div>

                    <div class="chapter collapsed">
                        <div class="chapter-header" onclick="toggleSection(this)">
                            <div class="chapter-main">
                                <span class="chapter-number">Chapter 18:</span>
                                <input type="text" class="chapter-title" value="Hand-Balancing">
                            </div>
                            <div class="collapse-icon">â–¼</div>
                        </div>
                        <div class="chapter-content">
                            <div class="subsection">
                                <span class="subsection-number">18.1</span>
                                <input type="text" class="subsection-title" value="The Endless Journey Philosophy">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">18.2</span>
                                <input type="text" class="subsection-title" value="Strength Requirements">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">18.3</span>
                                <input type="text" class="subsection-title" value="Balance Development">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">18.4</span>
                                <input type="text" class="subsection-title" value="Alignment Principles">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">18.5</span>
                                <input type="text" class="subsection-title" value="Mobility Prerequisites">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">18.6</span>
                                <input type="text" class="subsection-title" value="Entry Variations">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">18.7</span>
                                <input type="text" class="subsection-title" value="Training on Different Surfaces">
                            </div>
                        </div>
                    </div>

                    <div class="chapter collapsed">
                        <div class="chapter-header" onclick="toggleSection(this)">
                            <div class="chapter-main">
                                <span class="chapter-number">Chapter 19:</span>
                                <input type="text" class="chapter-title" value="Mobility Skills">
                            </div>
                            <div class="collapse-icon">â–¼</div>
                        </div>
                        <div class="chapter-content">
                            <div class="subsection">
                                <span class="subsection-number">19.1</span>
                                <input type="text" class="subsection-title" value="Mobility vs. Flexibility Distinction">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">19.2</span>
                                <input type="text" class="subsection-title" value="Strength Through Length">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">19.3</span>
                                <input type="text" class="subsection-title" value="The Squat">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">19.4</span>
                                <input type="text" class="subsection-title" value="The Forward Fold">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">19.5</span>
                                <input type="text" class="subsection-title" value="The Pancake">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">19.6</span>
                                <input type="text" class="subsection-title" value="The Splits (Front & Side)">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">19.7</span>
                                <input type="text" class="subsection-title" value="The Bridge">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">19.8</span>
                                <input type="text" class="subsection-title" value="The German Hang">
                            </div>
                        </div>
                    </div>

                    <div class="chapter collapsed">
                        <div class="chapter-header" onclick="toggleSection(this)">
                            <div class="chapter-main">
                                <span class="chapter-number">Chapter 20:</span>
                                <input type="text" class="chapter-title" value="Hybrid Paths">
                            </div>
                            <div class="collapse-icon">â–¼</div>
                        </div>
                        <div class="chapter-content">
                            <div class="subsection">
                                <span class="subsection-number">20.1</span>
                                <input type="text" class="subsection-title" value="The 'Well-Rounded' Athlete Myth">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">20.2</span>
                                <input type="text" class="subsection-title" value="Conflicting vs. Complementary Goals">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">20.3</span>
                                <input type="text" class="subsection-title" value="Double Session Strategies">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">20.4</span>
                                <input type="text" class="subsection-title" value="Bodybuilding + Power Free">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">20.5</span>
                                <input type="text" class="subsection-title" value="Bodybuilding + Street Lifting">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">20.6</span>
                                <input type="text" class="subsection-title" value="Power Free + Street Lifting">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">20.7</span>
                                <input type="text" class="subsection-title" value="Adding Handstands to Any Path">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">20.8</span>
                                <input type="text" class="subsection-title" value="Can You Have It All?">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Part V: DESIGN -->
            <div class="part">
                <div class="part-header" onclick="toggleSection(this)">
                    <div class="part-title">V: DESIGN â€” Building Your Own Program</div>
                    <div class="collapse-icon">â–¼</div>
                </div>
                <div class="chapters">
                    <div class="chapter collapsed">
                        <div class="chapter-header" onclick="toggleSection(this)">
                            <div class="chapter-main">
                                <span class="chapter-number">Chapter 21:</span>
                                <input type="text" class="chapter-title" value="Program Templates">
                            </div>
                            <div class="collapse-icon">â–¼</div>
                        </div>
                        <div class="chapter-content">
                            <div class="subsection">
                                <span class="subsection-number">21.1</span>
                                <input type="text" class="subsection-title" value="Template Selection Criteria">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">21.2</span>
                                <input type="text" class="subsection-title" value="Bodybuilding Templates">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">21.3</span>
                                <input type="text" class="subsection-title" value="Power Free Templates">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">21.4</span>
                                <input type="text" class="subsection-title" value="Freestyle Templates">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">21.5</span>
                                <input type="text" class="subsection-title" value="Street Lifting Templates">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">21.6</span>
                                <input type="text" class="subsection-title" value="Hand-Balancing Templates">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">21.7</span>
                                <input type="text" class="subsection-title" value="Mobility Templates">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">21.8</span>
                                <input type="text" class="subsection-title" value="Hybrid Templates">
                            </div>
                        </div>
                    </div>

                    <div class="chapter collapsed">
                        <div class="chapter-header" onclick="toggleSection(this)">
                            <div class="chapter-main">
                                <span class="chapter-number">Chapter 22:</span>
                                <input type="text" class="chapter-title" value="Constructing Your Routine">
                            </div>
                            <div class="collapse-icon">â–¼</div>
                        </div>
                        <div class="chapter-content">
                            <div class="subsection">
                                <span class="subsection-number">22.1</span>
                                <input type="text" class="subsection-title" value="Volume Calculations">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">22.2</span>
                                <input type="text" class="subsection-title" value="Frequency Optimization">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">22.3</span>
                                <input type="text" class="subsection-title" value="Intensity Management">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">22.4</span>
                                <input type="text" class="subsection-title" value="Exercise Selection">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">22.5</span>
                                <input type="text" class="subsection-title" value="Workout Split Options">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">22.6</span>
                                <input type="text" class="subsection-title" value="Periodization Models">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">22.7</span>
                                <input type="text" class="subsection-title" value="Deload Protocols">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">22.8</span>
                                <input type="text" class="subsection-title" value="Custom Program Examples">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Part VI: ENDURE -->
            <div class="part">
                <div class="part-header" onclick="toggleSection(this)">
                    <div class="part-title">VI: ENDURE â€” The Endless Journey</div>
                    <div class="collapse-icon">â–¼</div>
                </div>
                <div class="chapters">
                    <div class="chapter collapsed">
                        <div class="chapter-header" onclick="toggleSection(this)">
                            <div class="chapter-main">
                                <span class="chapter-number">Chapter 23:</span>
                                <input type="text" class="chapter-title" value="Working Around Injuries">
                            </div>
                            <div class="collapse-icon">â–¼</div>
                        </div>
                        <div class="chapter-content">
                            <div class="subsection">
                                <span class="subsection-number">23.1</span>
                                <input type="text" class="subsection-title" value="Accepting the Risk">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">23.2</span>
                                <input type="text" class="subsection-title" value="Pain Beyond The Body">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">23.3</span>
                                <input type="text" class="subsection-title" value="Knowing is Overrated">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">23.4</span>
                                <input type="text" class="subsection-title" value="Recovery Protocols">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">23.5</span>
                                <input type="text" class="subsection-title" value="Rehabilitation Strategies">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">23.6</span>
                                <input type="text" class="subsection-title" value="Do Not Miss the Lesson">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">23.7</span>
                                <input type="text" class="subsection-title" value="Coming Back Stronger">
                            </div>
                        </div>
                    </div>

                    <div class="chapter collapsed">
                        <div class="chapter-header" onclick="toggleSection(this)">
                            <div class="chapter-main">
                                <span class="chapter-number">Chapter 24:</span>
                                <input type="text" class="chapter-title" value="Patience is a Virtue">
                            </div>
                            <div class="collapse-icon">â–¼</div>
                        </div>
                        <div class="chapter-content">
                            <div class="subsection">
                                <span class="subsection-number">24.1</span>
                                <input type="text" class="subsection-title" value="Do Not Rush (The Slow Cook)">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">24.2</span>
                                <input type="text" class="subsection-title" value="Enjoy the Process">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">24.3</span>
                                <input type="text" class="subsection-title" value="Celebrate Small Wins">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">24.4</span>
                                <input type="text" class="subsection-title" value="You Are One Workout Away">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">24.5</span>
                                <input type="text" class="subsection-title" value="Comparison is the Thief of Joy">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">24.6</span>
                                <input type="text" class="subsection-title" value="Discipline vs. Motivation">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">24.7</span>
                                <input type="text" class="subsection-title" value="The Long Game">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Part VII: LEGACY -->
            <div class="part">
                <div class="part-header" onclick="toggleSection(this)">
                    <div class="part-title">VII: LEGACY â€” The Art of Service</div>
                    <div class="collapse-icon">â–¼</div>
                </div>
                <div class="chapters">
                    <div class="chapter collapsed">
                        <div class="chapter-header" onclick="toggleSection(this)">
                            <div class="chapter-main">
                                <span class="chapter-number">Chapter 25:</span>
                                <input type="text" class="chapter-title" value="What is Next?">
                            </div>
                            <div class="collapse-icon">â–¼</div>
                        </div>
                        <div class="chapter-content">
                            <div class="subsection">
                                <span class="subsection-number">25.1</span>
                                <input type="text" class="subsection-title" value="Play The Long Game">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">25.2</span>
                                <input type="text" class="subsection-title" value="Remember Why You Started">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">25.3</span>
                                <input type="text" class="subsection-title" value="The Never-Ending Journey">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">25.4</span>
                                <input type="text" class="subsection-title" value="Evolution of Practice">
                            </div>
                        </div>
                    </div>

                    <div class="chapter collapsed">
                        <div class="chapter-header" onclick="toggleSection(this)">
                            <div class="chapter-main">
                                <span class="chapter-number">Chapter 26:</span>
                                <input type="text" class="chapter-title" value="Passing The Torch">
                            </div>
                            <div class="collapse-icon">â–¼</div>
                        </div>
                        <div class="chapter-content">
                            <div class="subsection">
                                <span class="subsection-number">26.1</span>
                                <input type="text" class="subsection-title" value="Teaching Others">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">26.2</span>
                                <input type="text" class="subsection-title" value="Building Community">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">26.3</span>
                                <input type="text" class="subsection-title" value="The Next Generation">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">26.4</span>
                                <input type="text" class="subsection-title" value="Living the Practice">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">26.5</span>
                                <input type="text" class="subsection-title" value="The Eternal Student">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- THE RETURN: Endless Journey -->
            <div class="section">
                <div class="section-header" onclick="toggleSection(this)">
                    <div class="section-title">THE RETURN: Endless Journey</div>
                    <div class="collapse-icon">â–¼</div>
                </div>
                <div class="section-content">
                    <div class="chapter collapsed">
                        <div class="chapter-header" onclick="toggleSection(this)">
                            <div class="chapter-main">
                                <span class="chapter-number">Chapter 27:</span>
                                <input type="text" class="chapter-title" value="Closing The Loop">
                            </div>
                            <div class="collapse-icon">â–¼</div>
                        </div>
                        <div class="chapter-content">
                            <div class="subsection">
                                <span class="subsection-number">27.1</span>
                                <input type="text" class="subsection-title" value="Beyond Movement">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">27.2</span>
                                <input type="text" class="subsection-title" value="Beyond Yourself">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">27.3</span>
                                <input type="text" class="subsection-title" value="Beyond Your Limits">
                            </div>
                            <div class="subsection">
                                <span class="subsection-number">27.4</span>
                                <input type="text" class="subsection-title" value="Coming Back Home">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Task Management -->
            <div class="task-list-container">
                <div class="task-list-header">
                    <div class="task-list-title">âœ… AUTHOR'S TASK LIST</div>
                    <button class="add-task-btn" onclick="addTask()">+ Add Task</button>
                </div>
                <div id="taskList">
                    <!-- Tasks will be added here dynamically -->
                </div>
            </div>

            <!-- Features Box -->
            <div class="corrections-box">
                <div class="corrections-title">ðŸš€ PROFESSIONAL FEATURES - FULLY STABILIZED</div>
                <ul class="corrections-list">
                    <li>All 27 chapters fully editable with persistent state</li>
                    <li>ðŸŽ¤ Enhanced voice commands: "expand all", "toggle subsections", "go to chapter 5"</li>
                    <li>ðŸŽ¨ Professional gradient editor with live preview</li>
                    <li>ðŸ“„ New subsections toggle for focused editing</li>
                    <li>âœ… Advanced task management with priorities</li>
                    <li>âŒ¨ï¸ Full keyboard shortcuts (Ctrl+S, Ctrl+E, Ctrl+R)</li>
                    <li>ðŸ’¾ Auto-save with visual feedback</li>
                    <li>ðŸ“± Responsive design for all devices</li>
                    <li>ðŸš€ Production-ready stability with error handling</li>
                    <li>Multiple export formats (HTML/Text/JSON)</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Floating Action Button -->
    <div class="fab" onclick="scrollToTop()" title="Back to Top">â†‘</div>

    <script>
        // Global state management
        let currentFontSize = 100;
        let recognition = null;
        let isListening = false;
        let tasks = [];
        let autoSaveTimeout = null;

        // Initialize application
        function init() {
            try {
                // Start with control panel minimized
                const controlPanel = document.getElementById('controlPanel');
                const controlToggle = document.getElementById('controlToggle');

                if (controlPanel && controlToggle) {
                    controlPanel.classList.add('minimized');
                    controlToggle.classList.add('visible');
                }

                // Load saved data
                loadSettings();
                loadTasks();

                // Initialize gradient preview
                updateGradient();

                // Set up auto-save
                setupAutoSave();

                console.log('âœ… TOC Editor initialized successfully!');
            } catch (error) {
                console.error('Initialization error:', error);
            }
        }

        // Control Panel Toggle
        function toggleControlPanel() {
            try {
                const panel = document.getElementById('controlPanel');
                const toggle = document.getElementById('controlToggle');

                if (panel && toggle) {
                    if (panel.classList.contains('minimized')) {
                        panel.classList.remove('minimized');
                        toggle.classList.remove('visible');
                    } else {
                        panel.classList.add('minimized');
                        toggle.classList.add('visible');
                    }
                }
            } catch (error) {
                console.error('Error toggling control panel:', error);
            }
        }

        // Theme Management - Fixed to handle both click events and programmatic calls
        function setTheme(theme, buttonElement = null) {
            try {
                // Remove all theme classes
                document.body.className = document.body.className.replace(/theme-\w+/g, '');

                // Remove active class from all theme buttons
                document.querySelectorAll('.theme-btn').forEach(btn => {
                    btn.classList.remove('active');
                });

                // Add active class to the correct button
                if (buttonElement) {
                    buttonElement.classList.add('active');
                } else {
                    // Find button by theme name when called programmatically
                    document.querySelectorAll('.theme-btn').forEach(btn => {
                        const btnText = btn.textContent.toLowerCase();
                        if (btnText.includes(theme)) {
                            btn.classList.add('active');
                        }
                    });
                }

                // Apply theme styles
                switch(theme) {
                    case 'dark':
                        document.body.style.background = 'linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%)';
                        document.body.style.color = '#ffffff';
                        break;
                    case 'minimal':
                        document.body.classList.add('theme-minimal');
                        document.body.style.background = '#ffffff';
                        break;
                    case 'paper':
                        document.body.classList.add('theme-paper');
                        document.body.style.background = '#faf8f1';
                        break;
                    case 'mono':
                        document.body.classList.add('theme-mono');
                        document.body.style.background = '#000000';
                        break;
                    case 'ocean':
                        document.body.style.background = 'linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%)';
                        document.body.style.color = '#ffffff';
                        break;
                }

                localStorage.setItem('selectedTheme', theme);
                showNotification(`ðŸŽ¨ ${theme.charAt(0).toUpperCase() + theme.slice(1)} theme applied`);
            } catch (error) {
                console.error('Error setting theme:', error);
            }
        }

        // Section Toggling with improved error handling
        function toggleSection(headerElement) {
            try {
                if (!headerElement) return;

                const container = headerElement.closest('.section, .part, .chapter, .major-subsection');
                if (container) {
                    container.classList.toggle('collapsed');
                    saveCollapseStates();
                }
            } catch (error) {
                console.error('Error toggling section:', error);
            }
        }

        // Toggle All Sections
        function toggleAllSections() {
            try {
                const allSections = document.querySelectorAll('.section, .part, .chapter, .major-subsection');
                const anyExpanded = Array.from(allSections).some(el => !el.classList.contains('collapsed'));

                allSections.forEach(section => {
                    if (anyExpanded) {
                        section.classList.add('collapsed');
                    } else {
                        section.classList.remove('collapsed');
                    }
                });

                saveCollapseStates();
                showNotification(anyExpanded ? 'ðŸ“ All sections collapsed' : 'ðŸ“‚ All sections expanded');
            } catch (error) {
                console.error('Error toggling all sections:', error);
            }
        }

        // NEW: Toggle Subsections Only
        function toggleSubsections() {
            try {
                const subsections = document.querySelectorAll('.chapter, .major-subsection');
                const anyExpanded = Array.from(subsections).some(el => !el.classList.contains('collapsed'));

                subsections.forEach(section => {
                    if (anyExpanded) {
                        section.classList.add('collapsed');
                    } else {
                        section.classList.remove('collapsed');
                    }
                });

                saveCollapseStates();
                showNotification(anyExpanded ? 'ðŸ“„ Subsections collapsed' : 'ðŸ“„ Subsections expanded');
            } catch (error) {
                console.error('Error toggling subsections:', error);
            }
        }

        // Mobile Mode Toggle
        function toggleMobileMode() {
            try {
                document.body.classList.toggle('mobile-mode');
                const btn = document.getElementById('mobileBtn');
                const isMobile = document.body.classList.contains('mobile-mode');
                if (btn) {
                    btn.textContent = isMobile ? 'ðŸ’» Desktop View' : 'ðŸ“± Mobile View';
                }
                localStorage.setItem('mobileMode', isMobile);
                showNotification(isMobile ? 'ðŸ“± Mobile mode activated' : 'ðŸ’» Desktop mode activated');
            } catch (error) {
                console.error('Error toggling mobile mode:', error);
            }
        }

        // Font Size Control
        function adjustFontSize(delta) {
            try {
                currentFontSize = Math.max(50, Math.min(200, currentFontSize + (delta * 10)));
                document.documentElement.style.fontSize = currentFontSize + '%';
                const display = document.getElementById('fontSizeDisplay');
                if (display) {
                    display.textContent = currentFontSize + '%';
                }
                localStorage.setItem('fontSize', currentFontSize);
                showNotification(`ðŸ” Font size: ${currentFontSize}%`);
            } catch (error) {
                console.error('Error adjusting font size:', error);
            }
        }

        // Font Family Change
        function changeFontFamily() {
            try {
                const fontFamily = document.getElementById('fontFamily').value;
                document.body.style.fontFamily = fontFamily;
                localStorage.setItem('fontFamily', fontFamily);
                showNotification(`ðŸ”¤ Font changed to ${fontFamily.split(',')[0].replace(/'/g, '')}`);
            } catch (error) {
                console.error('Error changing font family:', error);
            }
        }

        // Enhanced Voice Commands
        function toggleVoiceCommands() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                alert('Voice commands are not supported in your browser. Please use Chrome or Edge.');
                return;
            }

            try {
                if (!recognition) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    recognition = new SpeechRecognition();
                    recognition.continuous = true;
                    recognition.lang = 'en-US';

                    recognition.onresult = function(event) {
                        try {
                            const last = event.results.length - 1;
                            const command = event.results[last][0].transcript.toLowerCase().trim();
                            processVoiceCommand(command);
                        } catch (error) {
                            console.error('Voice recognition result error:', error);
                        }
                    };

                    recognition.onerror = function(event) {
                        console.error('Voice recognition error:', event.error);
                        stopVoiceCommands();
                    };
                }

                if (isListening) {
                    stopVoiceCommands();
                } else {
                    startVoiceCommands();
                }
            } catch (error) {
                console.error('Error with voice commands:', error);
            }
        }

        function startVoiceCommands() {
            try {
                recognition.start();
                isListening = true;
                const voiceBtn = document.getElementById('voiceBtn');
                const voiceIndicator = document.getElementById('voiceIndicator');

                if (voiceBtn) voiceBtn.textContent = 'ðŸ”´ Stop Voice';
                if (voiceIndicator) voiceIndicator.classList.add('active');
            } catch (error) {
                console.error('Error starting voice commands:', error);
            }
        }

        function stopVoiceCommands() {
            try {
                if (recognition) {
                    recognition.stop();
                }
                isListening = false;
                const voiceBtn = document.getElementById('voiceBtn');
                const voiceIndicator = document.getElementById('voiceIndicator');

                if (voiceBtn) voiceBtn.textContent = 'ðŸŽ¤ Start Voice';
                if (voiceIndicator) voiceIndicator.classList.remove('active');
            } catch (error) {
                console.error('Error stopping voice commands:', error);
            }
        }

        function processVoiceCommand(command) {
            try {
                // Clean up command
                command = command.toLowerCase().replace(/[.,!?]/g, '').trim();

                if (command.includes('expand all') || command.includes('open all')) {
                    document.querySelectorAll('.collapsed').forEach(el => el.classList.remove('collapsed'));
                    showNotification('ðŸ“‚ All sections expanded');
                }
                else if (command.includes('collapse all') || command.includes('close all')) {
                    document.querySelectorAll('.section, .part, .chapter, .major-subsection').forEach(el => el.classList.add('collapsed'));
                    showNotification('ðŸ“ All sections collapsed');
                }
                else if (command.includes('toggle subsection') || command.includes('expand subsection') || command.includes('collapse subsection')) {
                    toggleSubsections();
                }
                else if (command.includes('show controls') || command.includes('hide controls')) {
                    toggleControlPanel();
                    showNotification('ðŸŽ¨ Controls toggled');
                }
                else if (command.includes('go to chapter') || command.includes('chapter')) {
                    const match = command.match(/chapter (\d+)/);
                    if (match) {
                        const chapterNum = parseInt(match[1]);
                        const chapters = document.querySelectorAll('.chapter');
                        if (chapters[chapterNum - 1]) {
                            chapters[chapterNum - 1].scrollIntoView({ behavior: 'smooth', block: 'center' });
                            chapters[chapterNum - 1].classList.remove('collapsed');
                            // Also expand parent part
                            const part = chapters[chapterNum - 1].closest('.part');
                            if (part) part.classList.remove('collapsed');
                            showNotification(`ðŸ“– Navigated to Chapter ${chapterNum}`);
                        }
                    }
                }
                else if (command.includes('add task') || command.includes('new task')) {
                    addTask();
                    showNotification('âœ… New task added');
                }
                else if (command.includes('export') || command.includes('save')) {
                    exportTOC();
                    showNotification('ðŸ’¾ Exporting document');
                }
                else if (command.includes('dark theme')) {
                    setTheme('dark');
                }
                else if (command.includes('light theme') || command.includes('minimal')) {
                    setTheme('minimal');
                }
                else if (command.includes('mobile mode')) {
                    toggleMobileMode();
                }
                else if (command.includes('bigger') || command.includes('larger')) {
                    adjustFontSize(1);
                }
                else if (command.includes('smaller')) {
                    adjustFontSize(-1);
                }
                else if (command.includes('scroll to top') || command.includes('top')) {
                    scrollToTop();
                    showNotification('â¬†ï¸ Scrolled to top');
                }
                else if (command.includes('help')) {
                    showVoiceHelp();
                }
                else {
                    showNotification('â“ Command not recognized. Say "help" for available commands.');
                }
            } catch (error) {
                console.error('Error processing voice command:', error);
            }
        }

        function showVoiceHelp() {
            const helpText = `ðŸŽ¤ ENHANCED VOICE COMMANDS:

Navigation:
â€¢ "expand all" / "collapse all"
â€¢ "toggle subsections" / "expand subsections"
â€¢ "go to chapter [number]"
â€¢ "scroll to top"

Controls:
â€¢ "show controls" / "hide controls"

Tasks:
â€¢ "add task" / "new task"

Themes:
â€¢ "dark theme" / "light theme"
â€¢ "mobile mode"

Text:
â€¢ "bigger" / "smaller" (font size)

Export:
â€¢ "export" / "save"

Say any command clearly!`;
            alert(helpText);
        }

        // Notification System
        function showNotification(message) {
            try {
                // Create notification element
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: linear-gradient(135deg, #43e97b, #38f9d7);
                    color: #000;
                    padding: 12px 20px;
                    border-radius: 8px;
                    font-weight: 600;
                    z-index: 10000;
                    box-shadow: 0 4px 12px rgba(67, 233, 123, 0.3);
                    transform: translateX(100%);
                    transition: transform 0.3s ease;
                `;
                notification.textContent = message;
                document.body.appendChild(notification);

                // Animate in
                setTimeout(() => {
                    notification.style.transform = 'translateX(0)';
                }, 10);

                // Animate out and remove
                setTimeout(() => {
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, 2700);
            } catch (error) {
                console.error('Error showing notification:', error);
            }
        }

        // Gradient Editor
        function updateGradient() {
            try {
                const startColor = document.getElementById('gradientStart')?.value || '#667eea';
                const endColor = document.getElementById('gradientEnd')?.value || '#764ba2';
                const startPos = document.getElementById('startPosition')?.value || '0';
                const endPos = document.getElementById('endPosition')?.value || '100';

                const gradient = `linear-gradient(135deg, ${startColor} ${startPos}%, ${endColor} ${endPos}%)`;
                const preview = document.getElementById('gradientPreview');
                if (preview) {
                    preview.style.background = gradient;
                }
            } catch (error) {
                console.error('Error updating gradient:', error);
            }
        }

        function applyPreset(preset) {
            try {
                let startColor, endColor;

                switch(preset) {
                    case 'ocean':
                        startColor = '#0077be';
                        endColor = '#00c6ff';
                        break;
                    case 'sunset':
                        startColor = '#ff6b6b';
                        endColor = '#feca57';
                        break;
                    case 'aurora':
                        startColor = '#43e97b';
                        endColor = '#38f9d7';
                        break;
                    case 'minimal':
                        startColor = '#333333';
                        endColor = '#666666';
                        break;
                    case 'mono':
                        startColor = '#000000';
                        endColor = '#333333';
                        break;
                    default:
                        return;
                }

                const startInput = document.getElementById('gradientStart');
                const endInput = document.getElementById('gradientEnd');

                if (startInput) startInput.value = startColor;
                if (endInput) endInput.value = endColor;

                updateGradient();
                showNotification(`ðŸŽ¨ ${preset.charAt(0).toUpperCase() + preset.slice(1)} preset applied`);
            } catch (error) {
                console.error('Error applying preset:', error);
            }
        }

        function applyGradientToSelection() {
            try {
                const activeElement = document.activeElement;
                if (activeElement && activeElement.tagName === 'INPUT') {
                    const startColor = document.getElementById('gradientStart')?.value || '#667eea';
                    const endColor = document.getElementById('gradientEnd')?.value || '#764ba2';

                    activeElement.style.background = `linear-gradient(135deg, ${startColor}, ${endColor})`;
                    activeElement.style.webkitBackgroundClip = 'text';
                    activeElement.style.webkitTextFillColor = 'transparent';
                    activeElement.style.backgroundClip = 'text';

                    showNotification('ðŸŽ¨ Gradient applied to selection');
                } else {
                    showNotification('âš ï¸ Please select a text field first');
                }
            } catch (error) {
                console.error('Error applying gradient to selection:', error);
            }
        }

        function applyGradientToAll() {
            try {
                const startColor = document.getElementById('gradientStart')?.value || '#667eea';
                const endColor = document.getElementById('gradientEnd')?.value || '#764ba2';
                const gradient = `linear-gradient(135deg, ${startColor}, ${endColor})`;

                document.querySelectorAll('.part-title, .section-title').forEach(el => {
                    el.style.background = gradient;
                    el.style.webkitBackgroundClip = 'text';
                    el.style.webkitTextFillColor = 'transparent';
                    el.style.backgroundClip = 'text';
                });

                showNotification('ðŸŽ¨ Gradient applied to all titles');
            } catch (error) {
                console.error('Error applying gradient to all:', error);
            }
        }

        // Task Management
        function loadTasks() {
            try {
                tasks = JSON.parse(localStorage.getItem('tocTasks')) || [];
                if (tasks.length === 0) {
                    // Add sample tasks
                    tasks = [
                        { text: 'Review Chapter 1 subsections', completed: false, priority: 'high' },
                        { text: 'Add movement diagrams to Chapter 13', completed: false, priority: 'medium' },
                        { text: 'Finalize Part VII legacy content', completed: false, priority: 'low' }
                    ];
                }
                renderTasks();
            } catch (error) {
                console.error('Error loading tasks:', error);
                tasks = [];
            }
        }

        function renderTasks() {
            try {
                const taskList = document.getElementById('taskList');
                if (!taskList) return;

                taskList.innerHTML = '';

                tasks.forEach((task, index) => {
                    const taskItem = document.createElement('div');
                    taskItem.className = 'task-item';
                    taskItem.innerHTML = `
                        <div class="task-checkbox ${task.completed ? 'checked' : ''}" onclick="toggleTask(${index})"></div>
                        <input type="text" class="task-text ${task.completed ? 'completed' : ''}"
                               value="${task.text}"
                               onchange="updateTask(${index}, this.value)">
                        <div class="task-priority priority-${task.priority}" onclick="cyclePriority(${index})">
                            ${task.priority.toUpperCase()}
                        </div>
                        <div class="delete-task" onclick="deleteTask(${index})">Ã—</div>
                    `;
                    taskList.appendChild(taskItem);
                });
            } catch (error) {
                console.error('Error rendering tasks:', error);
            }
        }

        function addTask() {
            try {
                const newTask = {
                    text: 'New task - click to edit',
                    completed: false,
                    priority: 'medium'
                };
                tasks.push(newTask);
                saveTasks();
                renderTasks();
            } catch (error) {
                console.error('Error adding task:', error);
            }
        }

        function toggleTask(index) {
            try {
                if (tasks[index]) {
                    tasks[index].completed = !tasks[index].completed;
                    saveTasks();
                    renderTasks();
                }
            } catch (error) {
                console.error('Error toggling task:', error);
            }
        }

        function updateTask(index, text) {
            try {
                if (tasks[index]) {
                    tasks[index].text = text;
                    saveTasks();
                }
            } catch (error) {
                console.error('Error updating task:', error);
            }
        }

        function cyclePriority(index) {
            try {
                if (tasks[index]) {
                    const priorities = ['low', 'medium', 'high'];
                    const currentIndex = priorities.indexOf(tasks[index].priority);
                    tasks[index].priority = priorities[(currentIndex + 1) % 3];
                    saveTasks();
                    renderTasks();
                }
            } catch (error) {
                console.error('Error cycling priority:', error);
            }
        }

        function deleteTask(index) {
            try {
                tasks.splice(index, 1);
                saveTasks();
                renderTasks();
            } catch (error) {
                console.error('Error deleting task:', error);
            }
        }

        function saveTasks() {
            try {
                localStorage.setItem('tocTasks', JSON.stringify(tasks));
            } catch (error) {
                console.error('Error saving tasks:', error);
            }
        }

        // Export Functions
        function exportTOC() {
            try {
                const tocContent = document.querySelector('.toc-container')?.outerHTML || '';
                const html = `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>The Art of Calisthenics - TOC Export</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 40px; background: #f5f5f5; }
        .toc-container { max-width: 1200px; margin: 0 auto; background: white; padding: 40px; border-radius: 10px; }
        input { border: none; width: 100%; font-size: inherit; background: transparent; }
    </style>
</head>
<body>
    ${tocContent}
</body>
</html>`;

                downloadFile(html, 'calisthenics-toc.html', 'text/html');
                showNotification('ðŸ’¾ HTML export complete');
            } catch (error) {
                console.error('Error exporting TOC:', error);
            }
        }

        function exportAsText() {
            try {
                let text = "THE ART OF CALISTHENICS - TABLE OF CONTENTS\n\n";

                // Gather all text from inputs
                document.querySelectorAll('input[type="text"]').forEach(input => {
                    const level = input.className.includes('part-title') ? '\n' :
                                 input.className.includes('chapter-title') ? '\n  ' :
                                 input.className.includes('subsection-title') ? '    - ' : '  â€¢ ';
                    text += level + input.value + '\n';
                });

                downloadFile(text, 'calisthenics-toc.txt', 'text/plain');
                showNotification('ðŸ“„ Text export complete');
            } catch (error) {
                console.error('Error exporting as text:', error);
            }
        }

        function exportAsJSON() {
            try {
                const tocData = {
                    metadata: {
                        title: "The Art of Calisthenics",
                        version: "2.0",
                        exportDate: new Date().toISOString(),
                        totalChapters: 27
                    },
                    tasks: tasks,
                    content: {}
                };

                // Collect all input values
                document.querySelectorAll('input[type="text"]').forEach((input, index) => {
                    tocData.content[`item_${index}`] = {
                        type: input.className,
                        value: input.value
                    };
                });

                const json = JSON.stringify(tocData, null, 2);
                downloadFile(json, 'calisthenics-toc.json', 'application/json');
                showNotification('ðŸ“Š JSON export complete');
            } catch (error) {
                console.error('Error exporting as JSON:', error);
            }
        }

        function downloadFile(content, filename, mimeType) {
            try {
                const blob = new Blob([content], { type: mimeType });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            } catch (error) {
                console.error('Error downloading file:', error);
            }
        }

        // Auto-save System
        function setupAutoSave() {
            try {
                document.addEventListener('input', (e) => {
                    if (e.target.type === 'text') {
                        clearTimeout(autoSaveTimeout);
                        autoSaveTimeout = setTimeout(() => {
                            saveAllData();
                            showAutoSaveIndicator();
                        }, 2000); // Auto-save after 2 seconds of inactivity
                    }
                });
            } catch (error) {
                console.error('Error setting up auto-save:', error);
            }
        }

        function saveAllData() {
            try {
                const data = {};
                document.querySelectorAll('input[type="text"]').forEach((input, index) => {
                    data[`input_${index}`] = input.value;
                });

                localStorage.setItem('tocInputs', JSON.stringify(data));
                saveCollapseStates();
            } catch (error) {
                console.error('Error saving all data:', error);
            }
        }

        function loadAllData() {
            try {
                const data = JSON.parse(localStorage.getItem('tocInputs')) || {};

                document.querySelectorAll('input[type="text"]').forEach((input, index) => {
                    const saved = data[`input_${index}`];
                    if (saved) {
                        input.value = saved;
                    }
                });
            } catch (error) {
                console.error('Error loading all data:', error);
            }
        }

        function saveCollapseStates() {
            try {
                const states = {};
                document.querySelectorAll('.section, .part, .chapter, .major-subsection').forEach((el, index) => {
                    states[`collapse_${index}`] = el.classList.contains('collapsed');
                });
                localStorage.setItem('collapseStates', JSON.stringify(states));
            } catch (error) {
                console.error('Error saving collapse states:', error);
            }
        }

        function loadCollapseStates() {
            try {
                const states = JSON.parse(localStorage.getItem('collapseStates')) || {};

                document.querySelectorAll('.section, .part, .chapter, .major-subsection').forEach((el, index) => {
                    const saved = states[`collapse_${index}`];
                    if (saved === true) {
                        el.classList.add('collapsed');
                    } else if (saved === false) {
                        el.classList.remove('collapsed');
                    }
                });
            } catch (error) {
                console.error('Error loading collapse states:', error);
            }
        }

        function showAutoSaveIndicator() {
            try {
                const indicator = document.getElementById('autoSaveIndicator');
                if (indicator) {
                    indicator.classList.add('show');
                    setTimeout(() => {
                        indicator.classList.remove('show');
                    }, 1500);
                }
            } catch (error) {
                console.error('Error showing auto-save indicator:', error);
            }
        }

        // Settings Management
        function loadSettings() {
            try {
                // Load theme
                const savedTheme = localStorage.getItem('selectedTheme') || 'dark';
                setTheme(savedTheme);

                // Load mobile mode
                const mobileMode = localStorage.getItem('mobileMode');
                if (mobileMode === 'true') {
                    document.body.classList.add('mobile-mode');
                    const mobileBtn = document.getElementById('mobileBtn');
                    if (mobileBtn) mobileBtn.textContent = 'ðŸ’» Desktop View';
                }

                // Load font size
                const savedFontSize = localStorage.getItem('fontSize');
                if (savedFontSize) {
                    currentFontSize = parseInt(savedFontSize);
                    document.documentElement.style.fontSize = currentFontSize + '%';
                    const fontDisplay = document.getElementById('fontSizeDisplay');
                    if (fontDisplay) fontDisplay.textContent = currentFontSize + '%';
                }

                // Load font family
                const savedFontFamily = localStorage.getItem('fontFamily');
                if (savedFontFamily) {
                    document.body.style.fontFamily = savedFontFamily;
                    const fontFamilySelect = document.getElementById('fontFamily');
                    if (fontFamilySelect) fontFamilySelect.value = savedFontFamily;
                }

                // Load all input data
                loadAllData();
                loadCollapseStates();

            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }

        // Utility Functions
        function scrollToTop() {
            try {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } catch (error) {
                console.error('Error scrolling to top:', error);
            }
        }

        // Keyboard Shortcuts
        document.addEventListener('keydown', (e) => {
            try {
                // Prevent shortcuts when typing in inputs
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                    return;
                }

                if ((e.ctrlKey || e.metaKey)) {
                    switch(e.key) {
                        case 's':
                            e.preventDefault();
                            exportTOC();
                            break;
                        case 'e':
                            e.preventDefault();
                            toggleAllSections();
                            break;
                        case 'r':
                            e.preventDefault();
                            toggleSubsections();
                            break;
                        case 'm':
                            e.preventDefault();
                            toggleMobileMode();
                            break;
                    }
                } else {
                    switch(e.key) {
                        case 'Escape':
                            if (isListening) {
                                stopVoiceCommands();
                            }
                            break;
                    }
                }
            } catch (error) {
                console.error('Error handling keyboard shortcut:', error);
            }
        });

        // Initialize when DOM is loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>